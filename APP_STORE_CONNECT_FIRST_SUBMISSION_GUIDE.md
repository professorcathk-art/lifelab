# App Store Connect - 首次提交指南

## ⚠️ 重要发现

您遇到的情况是正常的！这是 Apple 的政策要求。

---

## 🔍 问题 1: 为什么看不到"订阅"类型？

### 原因
- **首次创建 App 内购买项目时**，Apple 只显示"消耗性"和"非消耗性"
- **订阅类型**需要先提交应用版本后才能创建
- 这是 Apple 的政策，确保应用已经准备好审核

### 解决方案
1. **先创建"非消耗性"项目**（临时方案）
2. **提交应用版本**（包含这个临时项目）
3. **审核通过后**，可以创建订阅项目

---

## 📋 问题 2: 首次提交要求

### Apple 的政策
> "首个 App 内购买项目必须以新的 App 版本提交。请先建立 App 内购买项目，然后从版本页面的「App 内购买项目和订阅项目」区段中选取该项目，再将版本提交至「App 审查」。"

**这意味着**：
- ✅ 您**必须先提交应用版本**
- ✅ 首次 App 内购买项目必须与应用版本一起提交
- ✅ 审核通过后，可以单独提交其他 App 内购买项目

---

## 🎯 解决方案：两步流程

### Step 1: 创建临时"非消耗性"项目（用于首次提交）

#### 1.1 创建非消耗性项目

**类型**：选择 **"非消耗性"**

**产品信息**：
- **參照名稱**：`LifeLab Premium Access`
- **產品 ID**：`com.resonance.lifelab.premium`（临时，用于首次提交）
- **价格**：设置价格（例如：$0.99）

**本地化**：
- **显示名称**：`LifeLab Premium Access`
- **描述**：`解锁完整功能`

**注意**：
- ⚠️ 这是**临时项目**，用于首次提交
- ⚠️ 审核通过后，可以删除或保留作为备用
- ✅ 产品 ID 可以不同，但建议使用不同的 ID

---

### Step 2: 准备应用版本提交

#### 2.1 填写应用信息

在 App Store Connect 中：

1. **进入应用页面**
2. **填写必需信息**：
   - **应用名称**
   - **副标题**（可选）
   - **类别**
   - **隐私政策 URL**（必需）
   - **应用描述**
   - **关键词**
   - **支持 URL**
   - **营销 URL**（可选）

#### 2.2 上传应用构建版本

**方法 1: 通过 Xcode**
1. 在 Xcode 中选择 **"Product"** → **"Archive"**
2. 等待构建完成
3. 在 Organizer 中点击 **"Distribute App"**
4. 选择 **"App Store Connect"**
5. 上传构建版本

**方法 2: 通过命令行**
```bash
# 构建应用
xcodebuild archive \
  -project LifeLab/LifeLab.xcodeproj \
  -scheme LifeLab \
  -archivePath build/LifeLab.xcarchive

# 导出 IPA
xcodebuild -exportArchive \
  -archivePath build/LifeLab.xcarchive \
  -exportPath build \
  -exportOptionsPlist ExportOptions.plist
```

#### 2.3 创建新版本

1. 在 App Store Connect 中
2. 点击 **"+"** → **"新版本"**
3. 填写版本号（例如：`1.0`）
4. 选择上传的构建版本

#### 2.4 关联 App 内购买项目

1. 在版本页面
2. 找到 **"App 内购买项目和订阅项目"** 区段
3. 点击 **"+"**
4. 选择刚才创建的临时项目：`LifeLab Premium Access`
5. 保存

#### 2.5 提交审核

1. 填写所有必需信息
2. 检查清单：
   - [ ] 应用信息完整
   - [ ] 构建版本已上传
   - [ ] App 内购买项目已关联
   - [ ] 隐私政策 URL 已填写
   - [ ] 应用描述已填写
3. 点击 **"提交以供审核"**

---

## ✅ Step 3: 审核通过后创建订阅项目

### 3.1 审核通过后

一旦应用审核通过（通常 1-3 天），您就可以：

1. **创建订阅项目**
   - 现在会看到 **"自动续期订阅"** 选项
   - 可以创建三个订阅产品

2. **单独提交订阅项目**
   - 不需要重新提交应用版本
   - 可以直接提交订阅项目审核

### 3.2 创建三个订阅产品

按照之前的指南创建：
- `com.resonance.lifelab.yearly`
- `com.resonance.lifelab.quarterly`
- `com.resonance.lifelab.monthly`

---

## 🔄 临时方案：修改代码支持两种模式

### 方案 A: 使用非消耗性项目（临时）

在审核期间，可以临时使用非消耗性项目：

```swift
// PaymentService.swift
private let productIDs: [String] = [
    "com.resonance.lifelab.premium",  // 临时：非消耗性项目
    // 审核通过后，替换为订阅项目
    // "com.resonance.lifelab.yearly",
    // "com.resonance.lifelab.quarterly",
    // "com.resonance.lifelab.monthly"
]
```

### 方案 B: 仅使用优惠码（推荐）

**更好的方案**：在审核期间，**只使用优惠码功能**，不显示支付选项。

**优点**：
- ✅ 不需要创建临时项目
- ✅ 审核通过后直接添加订阅
- ✅ 用户体验更好（测试期间免费）

**实现**：
- 在 `PaymentView` 中隐藏订阅选项
- 只显示优惠码按钮
- 审核通过后，再显示订阅选项

---

## 📋 推荐流程

### 阶段 1: 首次提交（当前）

1. ✅ **不创建 App 内购买项目**
2. ✅ **只使用优惠码功能**
3. ✅ **提交应用版本**（不包含 App 内购买项目）
4. ✅ **等待审核通过**

### 阶段 2: 审核通过后

1. ✅ **创建三个订阅产品**
2. ✅ **更新代码**：启用订阅功能
3. ✅ **提交订阅项目审核**
4. ✅ **发布应用**

---

## 🎯 具体步骤（推荐方案）

### Step 1: 准备应用提交

1. **填写应用信息**
   - 应用名称、描述、关键词等
   - 隐私政策 URL（必需）

2. **上传构建版本**
   - 通过 Xcode Archive
   - 或通过命令行

3. **创建版本**
   - 版本号：`1.0`
   - 选择构建版本

4. **提交审核**
   - **不包含 App 内购买项目**
   - 只提交应用本身

### Step 2: 审核通过后

1. **创建订阅产品**
   - 现在可以看到"自动续期订阅"选项
   - 创建三个订阅产品

2. **更新应用**
   - 启用订阅功能
   - 提交新版本（如果需要）

3. **提交订阅项目**
   - 单独提交订阅项目审核

---

## ⚠️ 重要提示

### 关于临时项目

如果您选择创建临时"非消耗性"项目：

- ⚠️ **产品 ID 必须不同**：`com.resonance.lifelab.premium`
- ⚠️ **代码需要临时修改**：支持这个产品 ID
- ⚠️ **审核通过后需要更新**：替换为订阅产品

### 关于优惠码方案

**推荐使用优惠码方案**：
- ✅ **不需要临时项目**
- ✅ **代码不需要修改**
- ✅ **审核通过后直接添加订阅**
- ✅ **用户体验更好**

---

## 📚 参考资源

### Apple 官方文档
- [App 内购买项目审核指南](https://developer.apple.com/app-store/review/guidelines/#in-app-purchase)
- [首次提交指南](https://developer.apple.com/app-store/review/)

### 相关指南
- `APP_STORE_CONNECT_IN_APP_PURCHASE_GUIDE.md` - 订阅产品创建指南（审核通过后使用）

---

## ✅ 总结

**当前情况**：
- ✅ 看不到订阅选项是正常的（首次提交）
- ✅ 需要先提交应用版本
- ✅ 审核通过后可以创建订阅项目

**推荐方案**：
1. ✅ **首次提交**：只提交应用，使用优惠码功能
2. ✅ **审核通过后**：创建订阅产品，启用支付功能

**这样最简单，也最符合 Apple 的政策！** 🎉
