# App Store Connect - App 内购买项目创建指南

## 📋 逐步指南

### Step 1: 进入 App 内购买项目页面

1. 登录 **App Store Connect**：https://appstoreconnect.apple.com
2. 点击 **"我的 App"**
3. 选择您的 **LifeLab** 应用
4. 点击左侧菜单 **"功能"**
5. 点击 **"App 内购买项目"**
6. 点击左上角 **"+"** 按钮

---

## 🎯 Step 2: 选择类型

### 选择：**自动续期订阅**

**为什么选择自动续期订阅？**
- ✅ 适合订阅服务（您的应用是订阅模式）
- ✅ 自动续订，用户无需手动操作
- ✅ 可以设置不同订阅周期（月付、季付、年付）
- ✅ 支持免费试用期

**其他类型说明**：
- **消耗型项目**：一次性购买，用完后可再次购买（如游戏币）
- **非消耗型项目**：一次性购买，永久拥有（如解锁功能）
- **非续期订阅**：有时间限制但不自动续订（如杂志订阅）

---

## 📝 Step 3: 填写产品信息

### 产品 1: 年付订阅

#### 3.1 參照名稱（参考名称）
```
LifeLab 年付订阅
```
或
```
LifeLab Yearly Subscription
```

**说明**：
- 这是内部参考名称，用户看不到
- 用于在 App Store Connect 中识别产品
- 可以使用中文或英文

#### 3.2 產品 ID（产品 ID）
```
com.resonance.lifelab.yearly
```

**重要**：
- ⚠️ **必须完全匹配**代码中的 Product ID
- ⚠️ **不能更改**（创建后无法修改）
- ⚠️ **区分大小写**
- ✅ 格式：`{Bundle ID}.{产品名称}`

#### 3.3 订阅组
- 选择 **"创建订阅组"**
- 订阅组名称：`LifeLab Premium`
- 显示名称：`LifeLab Premium`（用户看到的名称）

**重要**：
- ✅ 所有三个订阅（年付、季付、月付）必须使用**同一个订阅组**
- ✅ 这样用户可以在不同订阅之间切换

#### 3.4 订阅时长
- 选择 **"1 年"**

#### 3.5 价格
- 选择价格等级（例如：$94.99/年）
- 或设置自定义价格

#### 3.6 本地化
点击 **"添加本地化"**：
- **语言**：简体中文（或繁体中文）
- **显示名称**：`LifeLab 年付订阅`
- **描述**：`解锁完整功能，享受年度优惠价格`

---

### 产品 2: 季付订阅

#### 3.1 參照名稱
```
LifeLab 季付订阅
```

#### 3.2 產品 ID
```
com.resonance.lifelab.quarterly
```

#### 3.3 订阅组
- 选择 **"LifeLab Premium"**（使用已创建的订阅组）

#### 3.4 订阅时长
- 选择 **"3 个月"**

#### 3.5 价格
- 选择价格等级（例如：$29.99/季）

#### 3.6 本地化
- **显示名称**：`LifeLab 季付订阅`
- **描述**：`解锁完整功能，享受季度优惠价格`

---

### 产品 3: 月付订阅

#### 3.1 參照名稱
```
LifeLab 月付订阅
```

#### 3.2 產品 ID
```
com.resonance.lifelab.monthly
```

#### 3.3 订阅组
- 选择 **"LifeLab Premium"**（使用已创建的订阅组）

#### 3.4 订阅时长
- 选择 **"1 个月"**

#### 3.5 价格
- 选择价格等级（例如：$18.99/月）

#### 3.6 本地化
- **显示名称**：`LifeLab 月付订阅`
- **描述**：`解锁完整功能，按月订阅`

---

## ✅ Step 4: 保存并检查

### 4.1 保存产品
1. 填写完所有信息后
2. 点击右上角 **"存储"** 或 **"保存"**
3. 产品状态会显示为 **"准备提交"**

### 4.2 检查清单

**每个产品检查**：
- [ ] 产品 ID 与代码中完全一致
- [ ] 订阅组相同（所有三个产品）
- [ ] 订阅时长正确
- [ ] 价格已设置
- [ ] 本地化信息已添加

**代码检查**：
- [ ] `PaymentService.swift` 中的 Product IDs 匹配
- [ ] `PaymentView.swift` 中的 Product IDs 匹配

---

## 🔍 Step 5: 验证产品 ID

### 代码中的 Product IDs

在 `PaymentService.swift` 中：
```swift
private let productIDs: [String] = [
    "com.resonance.lifelab.yearly",      // ✅ 年付
    "com.resonance.lifelab.quarterly",  // ✅ 季付
    "com.resonance.lifelab.monthly"     // ✅ 月付
]
```

在 `PaymentView.swift` 中：
```swift
var productID: String {
    switch self {
    case .yearly: return "com.resonance.lifelab.yearly"
    case .quarterly: return "com.resonance.lifelab.quarterly"
    case .monthly: return "com.resonance.lifelab.monthly"
    }
}
```

**必须完全匹配！**

---

## 📊 完整示例

### 产品 1: 年付订阅

| 字段 | 值 |
|------|-----|
| **类型** | 自动续期订阅 |
| **參照名稱** | LifeLab 年付订阅 |
| **產品 ID** | `com.resonance.lifelab.yearly` |
| **订阅组** | LifeLab Premium |
| **订阅时长** | 1 年 |
| **价格** | $94.99/年 |
| **显示名称** | LifeLab 年付订阅 |
| **描述** | 解锁完整功能，享受年度优惠价格 |

### 产品 2: 季付订阅

| 字段 | 值 |
|------|-----|
| **类型** | 自动续期订阅 |
| **參照名稱** | LifeLab 季付订阅 |
| **產品 ID** | `com.resonance.lifelab.quarterly` |
| **订阅组** | LifeLab Premium |
| **订阅时长** | 3 个月 |
| **价格** | $29.99/季 |
| **显示名称** | LifeLab 季付订阅 |
| **描述** | 解锁完整功能，享受季度优惠价格 |

### 产品 3: 月付订阅

| 字段 | 值 |
|------|-----|
| **类型** | 自动续期订阅 |
| **參照名稱** | LifeLab 月付订阅 |
| **產品 ID** | `com.resonance.lifelab.monthly` |
| **订阅组** | LifeLab Premium |
| **订阅时长** | 1 个月 |
| **价格** | $18.99/月 |
| **显示名称** | LifeLab 月付订阅 |
| **描述** | 解锁完整功能，按月订阅 |

---

## ⚠️ 重要注意事项

### 1. 产品 ID 不能更改
- ⚠️ 创建后**无法修改**
- ⚠️ 必须与代码中**完全一致**
- ✅ 创建前仔细检查

### 2. 订阅组必须相同
- ✅ 所有三个订阅必须在**同一个订阅组**
- ✅ 这样用户可以在订阅之间切换
- ✅ 订阅组名称：`LifeLab Premium`

### 3. 价格设置
- 💰 可以设置不同地区的价格
- 💰 价格等级可以随时修改
- 💰 但需要重新提交审核

### 4. 本地化
- 🌐 建议至少添加中文和英文
- 🌐 显示名称和描述要清晰
- 🌐 描述会影响用户购买决策

---

## 🧪 Step 6: 测试准备

### 6.1 创建 Sandbox 测试账户

1. 在 App Store Connect 中
2. 进入 **"用户和访问"** → **"Sandbox 测试员"**
3. 点击 **"+"** 添加测试员
4. 填写：
   - **名字**：测试
   - **姓氏**：账户
   - **电子邮件**：使用真实邮箱（用于接收测试收据）
   - **密码**：设置密码
   - **国家/地区**：选择测试地区

### 6.2 测试流程

1. **在真实设备上测试**（模拟器不支持）
2. **登出 App Store**：设置 → App Store → 退出登录
3. **运行应用**
4. **进入支付页面**
5. **测试购买**：会弹出 Sandbox 登录提示
6. **使用 Sandbox 测试账户登录**
7. **完成购买**

---

## 📋 检查清单

### 创建产品前
- [ ] 确认 Bundle ID：`com.resonance.lifelab`
- [ ] 确认应用已创建
- [ ] 准备三个产品 ID

### 创建产品时
- [ ] 类型选择：自动续期订阅
- [ ] 參照名稱填写正确
- [ ] 產品 ID 与代码完全一致
- [ ] 订阅组相同（所有产品）
- [ ] 订阅时长正确
- [ ] 价格已设置
- [ ] 本地化信息已添加

### 创建产品后
- [ ] 验证产品 ID 与代码匹配
- [ ] 创建 Sandbox 测试账户
- [ ] 在真实设备上测试
- [ ] 验证购买流程正常

---

## 🎯 下一步

### 创建完产品后：
1. ✅ **测试购买流程**：使用 Sandbox 账户测试
2. ✅ **提交应用审核**：当应用准备好时
3. ✅ **等待审核通过**：通常需要 1-3 天
4. ✅ **发布应用**：审核通过后可以发布

---

## 📚 参考资源

### Apple 官方文档
- [App 内购买项目指南](https://developer.apple.com/in-app-purchase/)
- [订阅最佳实践](https://developer.apple.com/app-store/subscriptions/)

### 代码参考
- `PaymentService.swift` - 支付服务
- `PaymentView.swift` - 支付界面

---

## ✅ 总结

**创建三个订阅产品的步骤**：

1. ✅ **类型**：选择"自动续期订阅"
2. ✅ **參照名稱**：LifeLab 年付/季付/月付订阅
3. ✅ **產品 ID**：
   - `com.resonance.lifelab.yearly`
   - `com.resonance.lifelab.quarterly`
   - `com.resonance.lifelab.monthly`
4. ✅ **订阅组**：LifeLab Premium（所有产品相同）
5. ✅ **订阅时长**：1 年 / 3 个月 / 1 个月
6. ✅ **价格**：设置价格
7. ✅ **本地化**：添加中文显示名称和描述

**完成这些步骤后，您的订阅产品就创建好了！** 🎉
